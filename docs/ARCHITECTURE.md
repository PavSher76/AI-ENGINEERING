# Архитектура AI Engineering Platform

## Обзор системы

AI Engineering Platform - это комплексная система для инженерной деятельности с поддержкой искусственного интеллекта. Система построена на микросервисной архитектуре с использованием Docker контейнеров.

## Компоненты системы

### 1. Frontend (React + TypeScript)
- **Порт**: 3000
- **Технологии**: React 18, TypeScript, Material-UI, React Query
- **Функции**: Веб-интерфейс для взаимодействия с пользователями

### 2. Backend Services

#### RAG Service (8001)
- **Назначение**: Работа с векторными базами данных и поиск по документам
- **Технологии**: FastAPI, ChromaDB, Sentence Transformers
- **Функции**:
  - Создание и управление коллекциями документов
  - Загрузка и обработка документов
  - Семантический поиск по документам
  - Создание эмбеддингов

#### AI-NK Service (8002)
- **Назначение**: Основной ИИ модуль для инженерных задач
- **Технологии**: FastAPI, Ollama, LangChain
- **Функции**:
  - Чат с ИИ с использованием RAG
  - Инженерные расчеты
  - Анализ проектов
  - Генерация отчетов
  - Управление контекстом

#### Chat Service (8003)
- **Назначение**: Специализированный сервис для чата с ИИ
- **Функции**: Управление сессиями чата, история сообщений

#### Consultation Service (8004)
- **Назначение**: Консультации по нормативно-технической документации
- **Функции**: Поиск и анализ нормативных документов

#### Archive Service (8005)
- **Назначение**: Управление архивом и объектами-аналогами
- **Функции**: Хранение и поиск архивных документов

#### Calculation Service (8006)
- **Назначение**: Выполнение инженерных расчетов
- **Функции**: Математические и инженерные вычисления

#### Validation Service (8007)
- **Назначение**: Валидация данных и документов
- **Функции**: Проверка исходных данных, валидация IFC файлов

#### Document Service (8008)
- **Назначение**: Управление проектной документацией
- **Функции**: CRUD операции с документами, версионирование

#### Analytics Service (8009)
- **Назначение**: Глубокая аналитика проектов
- **Функции**: Анализ соответствия нормам, техническая аналитика

#### Integration Service (8010)
- **Назначение**: Интеграция с внешними системами
- **Функции**: Интеграция с 3DEXPERIENCE/ENOVIA

### 3. Infrastructure Services

#### PostgreSQL (5432)
- **Назначение**: Основная реляционная база данных
- **Функции**: Хранение структурированных данных

#### Redis (6379)
- **Назначение**: Кэширование и управление сессиями
- **Функции**: Кэш, очереди задач, контекст

#### ChromaDB (8000)
- **Назначение**: Векторная база данных
- **Функции**: Хранение эмбеддингов документов

#### MinIO (9000/9001)
- **Назначение**: Объектное хранилище файлов
- **Функции**: Хранение документов и файлов

#### RabbitMQ (5672/15672)
- **Назначение**: Очереди сообщений
- **Функции**: Асинхронная обработка задач

#### Keycloak (8080)
- **Назначение**: SSO аутентификация и авторизация
- **Функции**: Управление пользователями, ролями, токенами

#### Nginx (80/443)
- **Назначение**: Reverse proxy и балансировщик нагрузки
- **Функции**: Маршрутизация запросов, SSL терминация

## Потоки данных

### 1. Загрузка документа
1. Пользователь загружает файл через Frontend
2. Frontend отправляет файл в RAG Service
3. RAG Service сохраняет файл в MinIO
4. RAG Service извлекает текст из документа
5. RAG Service создает эмбеддинги через Sentence Transformers
6. Эмбеддинги сохраняются в ChromaDB
7. Метаданные документа сохраняются в PostgreSQL

### 2. Чат с ИИ
1. Пользователь отправляет сообщение через Frontend
2. Frontend отправляет запрос в AI-NK Service
3. AI-NK Service получает контекст из Context Service
4. AI-NK Service выполняет поиск релевантных документов через RAG Service
5. AI-NK Service формирует промпт с контекстом и документами
6. AI-NK Service отправляет запрос в Ollama
7. Ollama генерирует ответ
8. AI-NK Service сохраняет контекст и возвращает ответ

### 3. Инженерный расчет
1. Пользователь вводит параметры расчета
2. Frontend отправляет запрос в AI-NK Service
3. AI-NK Service определяет тип расчета
4. Для стандартных расчетов используется Calculation Service
5. Для сложных расчетов используется Ollama
6. Результат сохраняется в PostgreSQL
7. Результат возвращается пользователю

## Безопасность

### Аутентификация
- Используется Keycloak для SSO
- JWT токены для API аутентификации
- Автоматическое обновление токенов

### Авторизация
- Ролевая модель доступа
- Проверка прав на уровне API
- Изоляция данных по проектам

### Защита данных
- Шифрование данных в покое
- HTTPS для всех соединений
- Валидация входных данных

## Масштабируемость

### Горизонтальное масштабирование
- Каждый сервис может масштабироваться независимо
- Load balancer для распределения нагрузки
- Stateless сервисы для простого масштабирования

### Вертикальное масштабирование
- Настройка ресурсов для каждого контейнера
- Мониторинг использования ресурсов
- Автоматическое масштабирование на основе метрик

## Мониторинг и логирование

### Логирование
- Централизованное логирование через Docker
- Структурированные логи в JSON формате
- Ротация логов для экономии места

### Мониторинг
- Health checks для всех сервисов
- Метрики производительности
- Алерты при критических ошибках

## Развертывание

### Development
- Docker Compose для локальной разработки
- Hot reload для фронтенда и бэкенда
- Автоматическая перезагрузка при изменениях

### Production
- Kubernetes для оркестрации
- CI/CD пайплайны
- Blue-green деплойменты
- Автоматические бэкапы

## Интеграции

### Ollama
- Локальная установка для работы с ИИ моделями
- Поддержка различных моделей (Llama, Mistral, etc.)
- API для генерации текста и эмбеддингов

### 3DEXPERIENCE/ENOVIA
- REST API для интеграции с PLM системами
- Синхронизация данных проектов
- Импорт/экспорт документов

### Внешние API
- Интеграция с нормативными базами данных
- Подключение к внешним расчетным сервисам
- API для работы с CAD системами
