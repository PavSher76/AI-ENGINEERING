# üîê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã SSL —Å Keycloak

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê

**–î–∞—Ç–∞**: 2 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## üö® –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞ SSL:**
```
Keycloak. 
–≠—Ç–æ—Ç —Å–∞–π—Ç –Ω–µ –º–æ–∂–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
–°–∞–π—Ç localhost –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.
ERR_SSL_PROTOCOL_ERROR
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ë—Ä–∞—É–∑–µ—Ä –ø—ã—Ç–∞–ª—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Keycloak —á–µ—Ä–µ–∑ HTTPS, –Ω–æ Keycloak –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ HTTP.

---

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–°–º–µ—à–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã** - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ HTTPS, Keycloak –Ω–∞ HTTP
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ HTTPS
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** hostname –≤ Keycloak
4. **–ü—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏** –¥–ª—è Keycloak

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Nginx –Ω–∞ HTTPS
- Keycloak –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ HTTP
- –ë—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–ª –Ω–∞ HTTPS
- Keycloak –Ω–µ –º–æ–≥ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å HTTPS –∑–∞–ø—Ä–æ—Å—ã

---

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Keycloak –Ω–∞ HTTP –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
**–§–∞–π–ª:** `docker-compose.yml`
```yaml
keycloak:
  image: quay.io/keycloak/keycloak:26.4.0
  command: start-dev --http-enabled=true --hostname-strict=false --import-realm --http-port=8080
  environment:
    KC_HTTP_ENABLED: true
    KC_HTTPS_ENABLED: false
    KC_HTTP_PORT: 8080
    KC_HOSTNAME_STRICT: false
    KC_PROXY: edge
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
**–§–∞–π–ª:** `docker-compose.yml`
```yaml
frontend:
  environment:
    - REACT_APP_API_URL=https://localhost/api
    - REACT_APP_KEYCLOAK_URL=http://localhost:8080
```

### 3. –°–º–µ—à–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
- **Frontend ‚Üí API**: HTTPS ‚Üí HTTPS ‚úÖ
- **Frontend ‚Üí Keycloak**: HTTPS ‚Üí HTTP ‚úÖ
- **CORS**: –ù–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- ‚úÖ **Keycloak –¥–æ—Å—Ç—É–ø–µ–Ω** –Ω–∞ HTTP
- ‚úÖ **Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç** —á–µ—Ä–µ–∑ HTTPS
- ‚úÖ **API –¥–æ—Å—Ç—É–ø–µ–Ω** —á–µ—Ä–µ–∑ HTTPS
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- ‚úÖ **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã** —É—Å–ø–µ—à–Ω–æ

### –ö–æ–º–∞–Ω–¥—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Keycloak
curl -s -I http://localhost:8080

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Frontend
curl -k -s -I https://localhost

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl -k -s https://localhost/api/chat/health

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
./scripts/test_auth_complete.sh
```

---

## üåê –§–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### URL-–∞–¥—Ä–µ—Å–∞:
- **Frontend**: https://localhost (—á–µ—Ä–µ–∑ Nginx)
- **API**: https://localhost/api (—á–µ—Ä–µ–∑ Nginx)
- **Keycloak**: http://localhost:8080
- **Keycloak Admin**: http://localhost:8080/admin

### –ü—Ä–æ—Ç–æ–∫–æ–ª—ã:
- **Frontend ‚Üí API**: HTTPS ‚Üí HTTPS ‚úÖ
- **Frontend ‚Üí Keycloak**: HTTPS ‚Üí HTTP ‚úÖ
- **CORS**: –ù–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞:
1. **SSL –æ—à–∏–±–∫–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã**
2. **Keycloak —Ä–∞–±–æ—Ç–∞–µ—Ç** –Ω–∞ HTTP
3. **Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç** —á–µ—Ä–µ–∑ HTTPS
4. **API –¥–æ—Å—Ç—É–ø–µ–Ω** —á–µ—Ä–µ–∑ HTTPS
5. **–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

### üöÄ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ Keycloak
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ API
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É:
1. **–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä** –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://localhost
2. **–ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Keycloak"**
3. **–í–≤–µ–¥–∏—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
   - **admin/admin** - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
   - **developer/developer** - –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
   - **analyst/analyst** - –ê–Ω–∞–ª–∏—Ç–∏–∫
   - **viewer/viewer** - –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å
4. **–ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ —Ñ—É–Ω–∫—Ü–∏—è–º —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–æ–ª—è–º

### –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:
- **Keycloak —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ HTTP** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ HTTPS** —á–µ—Ä–µ–∑ Nginx
- **–°–º–µ—à–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã** —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω** –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

## üîß –î–ª—è production

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** –¥–ª—è Keycloak
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ CA** —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
4. **–û–±–Ω–æ–≤–∏—Ç–µ CORS –ø–æ–ª–∏—Ç–∏–∫–∏** –¥–ª—è production

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è production:
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
./scripts/setup_ssl_local.sh

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Keycloak –Ω–∞ HTTPS
# (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
```

---

*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π AI Engineering Platform*
