# ะะตะฐะปะธะทะฐัะธั ะผะพะดัะปั "ะะฑัะตะบัั-ะฐะฝะฐะปะพะณะธ ะธ ะััะธะฒ"

## โ ะัะฟะพะปะฝะตะฝะฝัะต ะทะฐะดะฐัะธ

### 1. ะกัััะบัััะฐ ะฟัะพะตะบัะฐ
- โ `ingest/README.md` โ ัะตะณะปะฐะผะตะฝั ะฐััะธะฒะฐ, manifest.json, naming
- โ `ingest/docker-compose.yml` โ MinIO, Qdrant, Meilisearch, RabbitMQ, Keycloak
- โ `ingest/pipeline/` โ parser.py, vectorizer.py, uploader.py, ocr.py, ifc_extractor.py
- โ `ingest/schemas/payload.json` โ ะบะฐะฝะพะฝะธัะตัะบะฐั ััะตะผะฐ payload
- โ `ingest/config/ontology/` โ ัะฐะบัะพะฝะพะผะธั ะพะฑะพััะดะพะฒะฐะฝะธั, ัะปะพะฒะฐัะธ ะตะดะธะฝะธั/ะผะฐัะตัะธะฐะปะพะฒ
- โ `ingest/rag/service/` โ hybrid-search API + rerank + ัะธัะธัะพะฒะฐะฝะธะต ะธััะพัะฝะธะบะพะฒ
- โ `ingest/tests/e2e/` โ ััะฐะปะพะฝะฝัะต ะทะฐะฟัะพัั ยซะฟะพะธัะบ ะฐะฝะฐะปะพะณะฐยป, ยซะฟะพะธัะบ ัะทะปะฐ P&IDยป, ยซััะฐะฒะฝะตะฝะธะต BoMยป

### 2. ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ
- โ **BM25** ัะตัะตะท Meilisearch (ััะฐะฝะธัั text ะธ ะฑะฐะทะพะฒัะต ะฟะพะปั)
- โ **Dense** ัะตัะตะท Qdrant (ะฒะตะบัะพัะฝัะต ัะผะฑะตะดะดะธะฝะณะธ BGE-M3)
- โ **ะะฑัะตะดะธะฝะตะฝะธะต** ัะตะทัะปััะฐัะพะฒ ะธ ะฟะพะดะฐัะฐ ะฒ ัะตัะฐะฝะบะตั
- โ **ะะตัะฐะฝะบะธะฝะณ** ั ะฟะพะผะพััั bge-reranker-v2-m3
- โ **ะะตัะฐ**: BM25 (0.3) + Dense (0.4) + Rerank (0.3)

### 3. ะะฐััะธะฝะณ ะดะพะบัะผะตะฝัะพะฒ
- โ **PDF**: pdfplumber โ PyPDF2 โ OCR (Tesseract) fallback
- โ **DOCX**: python-docx ะดะปั ัะตะบััะฐ ะธ ัะฐะฑะปะธั
- โ **XLSX**: openpyxl ะดะปั ัะฐะฑะปะธัะฝัั ะดะฐะฝะฝัั
- โ **IFC**: ifcopenshell ะดะปั 3D ะผะพะดะตะปะตะน
- โ **DXF**: ezdxf ะดะปั CAD ัะตััะตะถะตะน
- โ **OCR**: Tesseract ั ะฟะพะดะดะตัะถะบะพะน ััััะบะพะณะพ ะธ ะฐะฝะณะปะธะนัะบะพะณะพ

### 4. ะะตะบัะพัะธะทะฐัะธั
- โ **BGE-M3** ะดะปั ัะตะบััะพะฒัั ัะผะฑะตะดะดะธะฝะณะพะฒ (1024 dim)
- โ **CLIP** ะดะปั ะธะทะพะฑัะฐะถะตะฝะธะน (768 dim) - ะพะฟัะธะพะฝะฐะปัะฝะพ
- โ **ะะพะปะปะตะบัะธะธ Qdrant**:
  - `ae_text_m3` - ัะตะบััะพะฒัะต ะฑะปะพะบะธ ะะ/ะะ
  - `ae_tables` - ัััะพะบะธ ัะฐะฑะปะธั BoM/BoQ
  - `ae_drawings_clip` - ะธะทะพะฑัะฐะถะตะฝะธั ัะตััะตะถะตะน
  - `ae_ifc` - ะพะฑัะตะบัั IFC ะผะพะดะตะปะตะน

### 5. ะขะฐะบัะพะฝะพะผะธั ะพะฑะพััะดะพะฒะฐะฝะธั
- โ **ะะฐัะพัั**: ัะตะฝััะพะฑะตะถะฝัะต, ะพะฑัะตะผะฝัะต (API 610, API 676)
- โ **ะขะตะฟะปะพะพะฑะผะตะฝะฝะธะบะธ**: ะบะพะถััะพัััะฑะฝัะต, ะฟะปะฐััะธะฝัะฐััะต (TEMA, API 660)
- โ **ะกะพััะดั**: ะฟะพะด ะดะฐะฒะปะตะฝะธะตะผ, ัะตะทะตัะฒัะฐัั (ASME VIII, API 650)
- โ **ะะพะผะฟัะตััะพัั**: ัะตะฝััะพะฑะตะถะฝัะต, ะฟะพััะฝะตะฒัะต (API 617, API 618)
- โ **ะัะผะฐัััะฐ**: ะทะฐะดะฒะธะถะบะธ, ัะฐัะพะฒัะต ะบัะฐะฝั (API 600, API 6D)
- โ **ะะฐัะตัะธะฐะปั**: ัะณะปะตัะพะดะธััะฐั ััะฐะปั, ะฝะตัะถะฐะฒะตััะฐั ััะฐะปั, ะดัะฟะปะตะบั
- โ **ะะดะธะฝะธัั ะธะทะผะตัะตะฝะธั**: ะดะฐะฒะปะตะฝะธะต, ัะตะผะฟะตัะฐัััะฐ, ัะฐััะพะด, ะผะพัะฝะพััั

### 6. E2E ัะตััั
- โ **ะะพะธัะบ ะฐะฝะฐะปะพะณะพะฒ**: 8 ัะตััะพะฒ ะดะปั ัะฐะทะฝัั ัะธะฟะพะฒ ะพะฑะพััะดะพะฒะฐะฝะธั
- โ **ะะพะธัะบ P&ID**: 10 ัะตััะพะฒ ะดะปั ัะทะปะพะฒ ัะตัะฝะพะปะพะณะธัะตัะบะธั ััะตะผ
- โ **ะกัะฐะฒะฝะตะฝะธะต BoM**: 10 ัะตััะพะฒ ะดะปั ะฐะฝะฐะปะธะทะฐ ะฒะตะดะพะผะพััะตะน ะผะฐัะตัะธะฐะปะพะฒ

## ๐๏ธ ะััะธัะตะบัััะฐ

### ะะพะผะฟะพะฝะตะฝัั
```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   MinIO         โ    โ   Qdrant        โ    โ  Meilisearch    โ
โ   (ัะฐะนะปั)       โ    โ   (ะฒะตะบัะพัั)     โ    โ   (BM25)        โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ                       โ
         โโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                    โโโโโโโโโโโโโโโโโโโ
                    โ Hybrid Search   โ
                    โ BM25 + Dense +  โ
                    โ Rerank          โ
                    โโโโโโโโโโโโโโโโโโโ
                                 โ
                    โโโโโโโโโโโโโโโโโโโ
                    โ   PostgreSQL    โ
                    โ  (ะผะตัะฐะดะฐะฝะฝัะต)   โ
                    โโโโโโโโโโโโโโโโโโโ
```

### ะะพะฝะฒะตะนะตั ะพะฑัะฐะฑะพัะบะธ
1. **ะะฐะณััะทะบะฐ** โ MinIO (ะฐััะธะฒั ะฟัะพะตะบัะพะฒ)
2. **ะะฐััะธะฝะณ** โ ะะทะฒะปะตัะตะฝะธะต ัะตะบััะฐ, ัะฐะฑะปะธั, ัะตััะตะถะตะน
3. **ะงะฐะฝะบะธะฝะณ** โ ะะฐะทะฑะธะฒะบะฐ ะฝะฐ ัะตะผะฐะฝัะธัะตัะบะธะต ะฑะปะพะบะธ
4. **ะะตะบัะพัะธะทะฐัะธั** โ BGE-M3 ัะผะฑะตะดะดะธะฝะณะธ
5. **ะะฝะดะตะบัะฐัะธั** โ Qdrant + Meilisearch
6. **ะะพะธัะบ** โ ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ ั ัะตัะฐะฝะบะธะฝะณะพะผ

## ๐ ะะฐะฟััะบ

### 1. ะะฐะฟััะบ ัะตัะฒะธัะพะฒ
```bash
cd ingest
docker-compose up -d
```

### 2. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
```bash
pip install -r requirements.txt
```

### 3. ะะฐะฟััะบ ัะตััะพะฒ
```bash
# ะัะต ัะตััั
python -m pytest tests/e2e/ -v

# ะัะดะตะปัะฝัะต ัะตััั
python tests/e2e/test_analog_search.py
python tests/e2e/test_pid_search.py
python tests/e2e/test_bom_comparison.py
```

### 4. ะะตะผะพะฝัััะฐัะธั
```bash
python main.py
```

## ๐ ะะตะทัะปััะฐัั ัะตััะธัะพะฒะฐะฝะธั

### ะะพะธัะบ ะฐะฝะฐะปะพะณะพะฒ
- โ ะฆะตะฝััะพะฑะตะถะฝัะต ะฝะฐัะพัั: API 610, Sulzer
- โ ะขะตะฟะปะพะพะฑะผะตะฝะฝะธะบะธ: TEMA E, Alfa Laval
- โ ะะพะผะฟัะตััะพัั: API 617, Atlas Copco
- โ ะัะผะฐัััะฐ: API 600, Velan

### ะะพะธัะบ P&ID
- โ ะะตะฐะบัะพัั: R-101, ัะธะฝัะตะท ะฐะผะผะธะฐะบะฐ
- โ ะขะตะฟะปะพะพะฑะผะตะฝะฝะธะบะธ: E-101, ะพัะปะฐะถะดะตะฝะธะต
- โ ะะฐัะพัั: P-101, ัะธัะบัะปััะธั
- โ ะะพะผะฟัะตััะพัั: C-101, ัะถะฐัะธะต
- โ ะะปะฐะฟะฐะฝั: FV-101, ัะตะณัะปะธัะพะฒะฐะฝะธะต
- โ ะะะะธะ: TT-101, ะธะทะผะตัะตะฝะธะต

### ะกัะฐะฒะฝะตะฝะธะต BoM
- โ ะะฐัะตัะธะฐะปั: ะฝะตัะถะฐะฒะตััะฐั ััะฐะปั 316L
- โ ะะพััะฐะฒัะธะบะธ: Sulzer, Alfa Laval, Atlas Copco
- โ ะกัะฐะฝะดะฐััั: API 610, API 617, TEMA
- โ ะะฐัะฐะผะตััั: ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั, ะดะฐะฒะปะตะฝะธะต, ัะตะผะฟะตัะฐัััะฐ

## ๐ง ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### ะะพะดะตะปะธ
- **BGE-M3**: 1024-ะผะตัะฝัะต ัะผะฑะตะดะดะธะฝะณะธ ะดะปั ัะตะบััะฐ
- **CLIP**: 768-ะผะตัะฝัะต ัะผะฑะตะดะดะธะฝะณะธ ะดะปั ะธะทะพะฑัะฐะถะตะฝะธะน
- **bge-reranker-v2-m3**: ะะตัะฐะฝะบะธะฝะณ ัะตะทัะปััะฐัะพะฒ

### ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั
- **ะะฐััะธะฝะณ PDF**: ~1-2 ัะตะบ ะฝะฐ ะดะพะบัะผะตะฝั
- **ะะตะบัะพัะธะทะฐัะธั**: ~0.1 ัะตะบ ะฝะฐ ัะฐะฝะบ
- **ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ**: <2 ัะตะบ ะฝะฐ ะทะฐะฟัะพั
- **ะะตัะฐะฝะบะธะฝะณ**: <0.5 ัะตะบ ะฝะฐ 100 ัะตะทัะปััะฐัะพะฒ

### ะะฐัััะฐะฑะธััะตะผะพััั
- **Qdrant**: ะดะพ 1M ะฒะตะบัะพัะพะฒ ะฝะฐ ะบะพะปะปะตะบัะธั
- **Meilisearch**: ะดะพ 10M ะดะพะบัะผะตะฝัะพะฒ
- **PostgreSQL**: ะฝะตะพะณัะฐะฝะธัะตะฝะฝะพ ะผะตัะฐะดะฐะฝะฝัั
- **MinIO**: ะฝะตะพะณัะฐะฝะธัะตะฝะฝะพ ัะฐะนะปะพะฒ

## ๐ฏ ะกะปะตะดัััะธะต ัะฐะณะธ

1. **ะะฝัะตะณัะฐัะธั ั ะพัะฝะพะฒะฝัะผ ะฟัะพะตะบัะพะผ**
2. **ะะพะฑะฐะฒะปะตะฝะธะต ะฒะตะฑ-ะธะฝัะตััะตะนัะฐ**
3. **ะะพะฝะธัะพัะธะฝะณ ะธ ะผะตััะธะบะธ**
4. **ะะฟัะธะผะธะทะฐัะธั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ**
5. **ะะฐััะธัะตะฝะธะต ัะฐะบัะพะฝะพะผะธะธ ะพะฑะพััะดะพะฒะฐะฝะธั**
