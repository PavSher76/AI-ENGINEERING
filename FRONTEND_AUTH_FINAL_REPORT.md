# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

## üìã –°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞:** 2025-10-09  
**–í—Ä–µ–º—è:** 23:37  
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –ù–ï –†–ê–ë–û–¢–ê–ï–¢

## üîç –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ production build
- ‚ùå `process.env.REACT_APP_KEYCLOAK_URL` = undefined
- ‚ùå `process.env.REACT_APP_KEYCLOAK_REALM` = undefined  
- ‚ùå `process.env.REACT_APP_KEYCLOAK_CLIENT_ID` = undefined
- ‚ùå `process.env.REACT_APP_ENABLE_KEYCLOAK` = undefined

### 2. Keycloak –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ Keycloak –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `https://localhost:9080`
- ‚úÖ Realm `ai-engineering` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ OpenID Connect endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚ùå –û—à–∏–±–∫–∞ `Missing parameter: code_challenge_method` –≤ silent-check-sso

### 3. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚ùå –í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚ùå ReactKeycloakProvider –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚ùå AuthContext –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ —á–∏—Ç–∞—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ

## üõ†Ô∏è –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Keycloak
```yaml
# docker-compose.yml
KC_HOSTNAME_URL: https://localhost:9080  # –±—ã–ª–æ 9443
KC_HOSTNAME_ADMIN_URL: https://localhost:9080  # –±—ã–ª–æ 9443
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ Keycloak
```json
// keycloak/ai-engineering-realm.json
"attributes": {
  "pkce.code.challenge.method": "S256",
  "pkce.code.challenge.method.required": "true"  // –¥–æ–±–∞–≤–ª–µ–Ω–æ
}
```

### 3. –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª env.example
```bash
# frontend/env.example
REACT_APP_KEYCLOAK_URL=https://localhost:9080
REACT_APP_KEYCLOAK_REALM=ai-engineering
REACT_APP_KEYCLOAK_CLIENT_ID=ai-frontend
REACT_APP_ENABLE_KEYCLOAK=true
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- –°–æ–∑–¥–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `OIDCDebug.tsx`
- –î–æ–±–∞–≤–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç `/debug/oidc`
- –§—É–Ω–∫—Ü–∏–∏: –ø–æ–ª—É—á–µ–Ω–∏–µ .well-known, –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ production build
**–ü—Ä–æ–±–ª–µ–º–∞:** React –Ω–µ –≤–∏–¥–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ production build.

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏, –∞ –Ω–µ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:**
```dockerfile
# frontend/Dockerfile
ENV REACT_APP_KEYCLOAK_URL=https://localhost:9080
ENV REACT_APP_KEYCLOAK_REALM=ai-engineering
ENV REACT_APP_KEYCLOAK_CLIENT_ID=ai-frontend
ENV REACT_APP_ENABLE_KEYCLOAK=true
```

### 2. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Dockerfile –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
docker-compose build --no-cache frontend
docker-compose up -d frontend
```

## üìã –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –®–∞–≥ 1: –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
```bash
cd /Users/macbook/Projects/AI-Engineering
docker-compose build --no-cache frontend
docker-compose up -d frontend
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker exec ai-engineering-frontend-1 env | grep REACT_APP
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
python3 scripts/test_auth_status.py
python3 scripts/test_frontend_console.py
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
–û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://localhost:9300/debug/oidc`

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –≤ Keycloak
```json
// –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ –¥–æ–±–∞–≤–∏—Ç—å:
"webOrigins": [
  "https://localhost:9300",
  "https://localhost",
  "+"  // –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
]
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
openssl s_client -connect localhost:9080 -servername localhost
```

### 3. –õ–æ–≥–∏ Keycloak
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Keycloak
docker logs ai-engineering-keycloak-1 | grep -i error
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|-----------|--------|---------|
| Keycloak –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å | ‚úÖ | –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 9080 |
| OpenID Connect | ‚úÖ | Endpoints –¥–æ—Å—Ç—É–ø–Ω—ã |
| –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è | ‚ùå | –ù–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ production |
| ReactKeycloakProvider | ‚ùå | –ù–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω |
| –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã | ‚ùå | –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ |
| PKCE | ‚ùå | –û—à–∏–±–∫–∞ code_challenge_method |

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥** —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É** `/debug/oidc`
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é** –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS** –≤ Keycloak –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSL** —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ production build React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å.

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Keycloak, OpenID Connect, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞) –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ.
